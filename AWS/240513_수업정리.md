# Jenkins ì´ì–´ì„œ
## í”„ë¦¬í‹°ì–´ëŠ” ì†ë„ê°€ ë„ˆë¬´ ëŠë¦¼..
![](../image/Pasted%20image%2020240513090819.png)

![](../image/ê³¼ì •1_ë°°í¬.txt)

ðŸ“Œì¸ìŠ¤í„´ìŠ¤ ìœ í˜•ì„ ë°”ê¿”ì•¼ í•  ê²ƒ ê°™ë‹¤...

![](../image/Pasted%20image%2020240513093049.png)

ðŸ“Œê²°êµ­ .. ë‹¤ì‹œ í•œë‹¤.

![](../image/Pasted%20image%2020240513093103.png)

ðŸ“Œì—„ì²­ ë¹ ë¥´ë‹¤.. 2ë°° ì •ë„?

ðŸ“Œjenkins url : http://54.180.113.25:8080/

![](../image/Pasted%20image%2020240513095022.png)

ðŸ“Œí›¨ì”¬.. ë¹ ë¥´ê²Œ(33ì´ˆ..) ë¹Œë“œê°€ ì™„ë£Œëœ ê²ƒì„ ë³¼ ìˆ˜ ìžˆë‹¤

![](../image/Pasted%20image%2020240513103747.png)


## jenkinsì—ì„œ scm ì ìš©í•˜ê¸°
ðŸ“Œì  í‚¨ìŠ¤ì—ì„œÂ SCMÂ ì ìš©í•˜ê¸°

pipelineÂ scriptë¥¼Â ê¹ƒì—ì„œÂ ê°€ì ¸ì™€ì„œÂ ìž‘ë™í•˜ë„ë¡Â í•©ë‹ˆë‹¤. ì´Â ë•ŒÂ SCMÂ ì„Â ì´ìš©í•©ë‹ˆë‹¤.
"PipelineÂ scriptÂ fromÂ SCM"ì€Â ì  í‚¨ìŠ¤(Â Jenkins)ì—ì„œÂ ì‚¬ìš©ë˜ëŠ”Â ê°œë…Â ì¤‘Â í•˜ë‚˜ë¡œ, ì†ŒìŠ¤Â ì½”ë“œÂ ê´€ë¦¬Â ì‹œìŠ¤í…œ(SourceÂ CodeÂ Management,Â SCM)ì—ì„œÂ íŒŒì´í”„ë¼ì¸Â ìŠ¤í¬ë¦½íŠ¸ë¥¼Â ê°€ì ¸ì™€Â ì‹¤í–‰í•˜ëŠ”Â ë©”ì»¤ë‹ˆì¦˜ì„Â ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.  

-Â ìž‘ì„±í•œÂ itemì˜Â Configureì—ì„œÂ Pipelineì„Â ìˆ˜ì •í•©ë‹ˆë‹¤.
- Pipeline
=>Â DefinitionÂ :Â PipelineÂ scriptÂ fromÂ SCM
=>Â SCMÂ :Â git
=>Â RepositoryÂ URLÂ :Â https://github.com/github_username/web2024.git
=>Â CredentialsÂ :Â github_username/\*\*\*\*(github)
=>Â BranchesÂ toÂ buildÂ Â BranchÂ SpecifierÂ (blankÂ forÂ 'any')Â :Â \*/main
=>Â ScriptÂ Path
=>Â Spring10_Security_Thymeleaf_Jenkins/Jenkinsfile_firstÂ (githubì—ì„œÂ ë§Œë“¤Â íŒŒì¼Â ëª…)
=>Â apply
=>Â ì €ìž¥

![](../image/Pasted%20image%2020240513104510.png)

![](../image/Pasted%20image%2020240513104959.png)

![](../image/Pasted%20image%2020240513105017.png)

ðŸ“Œìž‘ì—… ì™„ë£Œí•˜ë©´ ì´ëŸ° í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.

![](../image/ì „ì²´ê³¼ì •_ë°°í¬.txt)

## ë‘ ë²ˆì§¸ ê³¼ì •
![](../image/Pasted%20image%2020240513110921.png)

ðŸ“Œgithubì—ì„œ Jenkisfile_second ë¥¼ ë§Œë“ ë‹¤.

![](../image/Pasted%20image%2020240513111048.png)

ðŸ“Œconfiguration => Pileline => Definition => Script Path => github repoì— ì €ìž¥ëœ í”„ë¡œì íŠ¸ í´ë” + Jenkinsfile_secondë¡œ ê²½ë¡œë¥¼ ìˆ˜ì •í•œë‹¤.

![](../image/Pasted%20image%2020240513111015.png)

ðŸ“Œconfigurationì„ ì™„ë£Œí•œ í›„, ì§€ê¸ˆ ë¹Œë“œë¥¼ ëˆ„ë¥´ë©´, Dockerizing / Login / Docker hub push / Cleaning up ë“± ìƒˆë¡œìš´ í•­ëª©ì´ ì¶”ê°€ë˜ê³  ë¹Œë“œê°€ ì´ë¤„ì§„ë‹¤.

![](../image/Pasted%20image%2020240513110720.png)

![](../image/Pasted%20image%2020240513110838.png)

![](../image/Pasted%20image%2020240513111827.png)

![](../image/Pasted%20image%2020240513112016.png)

ðŸ“Œì´ ê³¼ì •ì´ ìž˜ ì´ë£¨ì–´ì¡Œë‹¤ë©´, docker hub ë“¤ì–´ê°€ì„œ raynerius/security repositoriesì— ë“¤ì–´ê°€ ë³¸ë‹¤. ì´ ì•ˆì—ì„œ ì„¸ë¶€ í•­ëª©ë“¤ì„ ë³´ë©´ latests / 4(ë¹Œë“œ ë²ˆí˜¸) ì´ë ‡ê²Œ ìƒˆë¡œìš´ imageê°€ ìƒê¸´ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.
- githubì—ì„œ ìž…ë ¥í•œ Jenkinsfile_second íŒŒì¼ì˜ 56~57 ë¼ì¸ì— ì˜í•´ì„œ latest / 4 ë¼ëŠ” ì´ë¯¸ì§€ê°€ ìƒì„±ëœ ê²ƒì´ë‹¤!
- docker hubì— pushëœ ê²ƒì€ 91~107 ë¼ì¸ì— ì˜í•´ì„œ ìˆ˜í–‰ëœ ê²ƒì´ë‹¤!

ðŸ“Œdocker-compose ì—ì„œëŠ” íƒœê·¸ ë²ˆí˜¸ë¥¼ ìž…ë ¥í•´ì¤˜ì•¼ í•˜ëŠ”ë°, ê·¸ ë²ˆí˜¸ë¥¼ í•­ìƒ latestê°€ ì ìš©ë˜ê²Œ í•˜ë ¤ê³ , latest ì´ë¯¸ì§€ë¥¼ ë§Œë“  ê²ƒì´ê³ , 1 2 3 4 ... ë¹Œë“œ ë²ˆí˜¸ê°€ ë¶™ëŠ” ê²ƒì€ ì¤‘ê°„ ê³¼ì •ì„ ë‚¨ê¸°ê¸° ìœ„í•´ì„œ ê·¸ëŸ° ê²ƒì´ë‹¤.


## ë‹¤ë¥¸ EC2ì— ì—°ê²° í•˜ê¸° ìœ„í•œ ê³¼ì •
![](../image/Pasted%20image%2020240513120352.png)
ðŸ“Œì „ì²´ê³¼ì •_ë°°í¬.txt ì—ì„œ 15ë²ˆ ë¶€í„° ì§„í–‰í•˜ë©´ ëœë‹¤.

### ê³µê°œí‚¤ì™€ ê°œì¸í‚¤ë¥¼ ë§Œë“¦
![](../image/Pasted%20image%2020240513120946.png)

![](../image/Pasted%20image%2020240513121258.png)

![](../image/Pasted%20image%2020240513121344.png)

![](../image/Pasted%20image%2020240513121912.png)

ðŸ“Œê³µê°œí‚¤ì™€ ê°œì¸í‚¤ê°€ ìž˜ ë§Œë“¤ì–´ì¡Œë‹¤. jenkins containerì—ì„œ í‚¤íŽ˜ì–´ë¥¼ ìƒì„±í–ˆë‹¤. (ì˜ˆì „ì—ëŠ” clickìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤)

![](../image/Pasted%20image%2020240513122430.png)

ðŸ“Œë°°í¬ìš© EC2ëŠ” ì›¹ ìƒíƒœì—ì„œ ì—´ì–´ì£¼ëŠ” ê²Œ íŽ¸í•¨. putty í•˜ë‚˜ ë” ì—´ë©´ ì¢€ í—·ê°ˆë¦¼.

![](../image/Pasted%20image%2020240513122714.png)

![](../image/Pasted%20image%2020240513122742.png)

ðŸ“Œweb-server ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ì—°ê²°í•˜ë©´ ì´ë ‡ê²Œ ì›¹ ìƒì—ì„œ cmd í™”ë©´ ê°™ì€ ì°½ì„ ë³¼ ìˆ˜ ìžˆë‹¤.

![](../image/Pasted%20image%2020240513123308.png)

![](../image/Pasted%20image%2020240513123347.png)

![](../image/Pasted%20image%2020240513123641.png)

ðŸ“Œì‹¤ìˆ˜.. jenkins ì—ì„œëŠ” authorized_keysë¥¼ ë³µì‚¬í•˜ëŠ” ê²Œ ì•„ë‹ˆì—ˆìŒ. jenkins ì»¨í…Œì´ë„ˆì— ìžˆëŠ” authorized_keysëŠ” ì‚­ì œí•˜ê³  ì§„í–‰í•˜ë‹ˆê¹Œ ìž˜ ë˜ì—ˆë‹¤.

![](../image/Pasted%20image%2020240513123836.png)

![](../image/Pasted%20image%2020240513140213.png)

ðŸ“Œjenkins container ì—ì„œ ls -al í–ˆë”ë‹ˆ, ì‹ ê¸°í•˜ê²Œë„ download í´ë”ì™€ oracle í´ë”ë¥¼ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.


## jenkinsì— ssh ì¸ì¦ ì •ë³´ ë“±ë¡
![](../image/Pasted%20image%2020240513141456.png)

![](../image/Pasted%20image%2020240513141804.png)

![](../image/Pasted%20image%2020240513141858.png)

ðŸ“Œì „ì²´ë¥¼ ë‹¤ ë³µì‚¬í•´ì„œ ë¶™ì—¬ ë„£ì–´ì•¼ í•œë‹¤.

![](../image/Pasted%20image%2020240513142104.png)

![](../image/Pasted%20image%2020240513142941.png)

ðŸ“Œì§€ê¸ˆ í•˜ê³  ìžˆëŠ” ìž‘ì—….

![](../image/Pasted%20image%2020240513143641.png)


### í…ŒìŠ¤íŠ¸
![](../image/Pasted%20image%2020240513143727.png)

```
pipeline {
    agent any
   environment {
       //@ë’¤ì—ëŠ” ë°°í¬ìš© ì¸ìŠ¤í„´ìŠ¤(web-server) public ì•„ì´í”¼

        TARGET_HOST = "ubuntu@43.202.113.6"
    }
    stages {
        stage('test ssh') {
            steps {        
                 sshagent (credentials: ['deploy-ec2']) {   
                 sh  'ssh -o StrictHostKeyChecking=no ${TARGET_HOST} "pwd"'
                }
            }
        }

        stage('multiline ssh') {
            steps {        
                sshagent (credentials: ['deploy-ec2']) {
                sh """
                    ssh -o StrictHostKeyChecking=no ${TARGET_HOST} '
                    rm -rf test
                    mkdir test
                    cd test
                    mkdir test2
                    cd test2
                    pwd
                    '
                """
                }
            }
        }
    }
    
}
```

ðŸ“Œí…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìž…ë ¥í•˜ì—¬ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´... ì»¨í…Œì´ë„ˆì— testë¼ëŠ” í´ë”ê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìžˆë‹¤.

![](../image/Pasted%20image%2020240513144235.png)

![](../image/Pasted%20image%2020240513144426.png)

![](../image/Pasted%20image%2020240513144529.png)

ðŸ“Œì½˜ì†” í™•ì¸í•´ë³´ë©´ SUCCESS ëœ¬ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.

### docker-compose up
![](../image/Pasted%20image%2020240513143011.png)


## Jenkinsfile_third
![](../image/Pasted%20image%2020240513150624.png)

![](../image/Pasted%20image%2020240513151138.png)

ðŸ“Œgithubì—ì„œ pull í•˜ê³  second ë³µì‚¬í•´ì„œ thirdë¥¼ ë§Œë“ ë‹¤.

ðŸ“Œthirdì— targethostì™€ multiline ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.

![](../image/Pasted%20image%2020240513152516.png)

ðŸ“Œdocker-compose.yaml íŒŒì¼ì˜ web_service ë¶€ë¶„ imageë¥¼ raynerius/securityë¡œ ë³€ê²½í•œë‹¤. (cat > ëª…ë ¹ì–´ ì‚¬ìš©)

